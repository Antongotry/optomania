<div id="reviews-container" class="pr-store-reviews-items d-flex flex-column gap-3">
    {% if reviews %}
        {% for review in reviews %}
            <div class="pr-product-reviews-item-box">
                <div class="pr-store-reviews-item br-12 d-flex flex-column gap-3 p-3 p-xl-4">
                    <div class="pr-store-reviews-item-author d-flex gap-3 align-items-center pb-3">
                        <div class="pr-store-reviews-rating-value position-relative d-flex align-items-center justify-content-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44" fill="none">
                                <path d="M30.1498 12.2144L25.3978 2.20951C23.9985 -0.7365 20.0015 -0.736504 18.6022 2.2095L13.8502 12.2144L3.26261 13.813C0.132974 14.2855 -1.1097 18.338 1.16772 20.6447L8.7994 28.3743L6.9938 39.3131C6.45621 42.57 9.69752 45.0652 12.4866 43.5416L22 38.3447L31.5134 43.5416C34.3025 45.0652 37.5438 42.57 37.0062 39.3131L35.2006 28.3743L42.8323 20.6447C45.1097 18.338 43.867 14.2855 40.7374 13.813L30.1498 12.2144Z" fill="#FFC445"></path>
                            </svg>
                            <span class="position-relative z-1 white-text fsz-12 fw-700 lh-sm">{{ review.rating }}</span>
                        </div>
                        <div class="pr-store-reviews-item-author-info d-flex flex-column gap-1">
                            <div class="pr-store-reviews-item-author-name dark-text fsz-14 fw-600">{{ review.author }}</div>
                            <div class="pr-store-reviews-item-date d-flex align-items-center gap-1 grey-text fsz-12">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="15" viewBox="0 0 14 15" fill="none">
                                    <path d="M1 5.16666H13M3.66667 1.16666V2.49999M10.3333 1.16666V2.49999M4 7.83332C4 8.01742 3.85076 8.16666 3.66667 8.16666C3.48257 8.16666 3.33333 8.01742 3.33333 7.83332M4 7.83332C4 7.64923 3.85076 7.49999 3.66667 7.49999C3.48257 7.49999 3.33333 7.64923 3.33333 7.83332M4 7.83332H3.33333M7.33333 7.83332C7.33333 8.01742 7.1841 8.16666 7 8.16666C6.81591 8.16666 6.66667 8.01742 6.66667 7.83332M7.33333 7.83332C7.33333 7.64923 7.1841 7.49999 7 7.49999C6.81591 7.49999 6.66667 7.64923 6.66667 7.83332M7.33333 7.83332H6.66667M10.6667 7.83332C10.6667 8.01742 10.5174 8.16666 10.3333 8.16666C10.1492 8.16666 10 8.01742 10 7.83332M10.6667 7.83332C10.6667 7.64923 10.5174 7.49999 10.3333 7.49999C10.1492 7.49999 10 7.64923 10 7.83332M10.6667 7.83332H10M4 11.1667C4 11.3508 3.85076 11.5 3.66667 11.5C3.48257 11.5 3.33333 11.3508 3.33333 11.1667M4 11.1667C4 10.9826 3.85076 10.8333 3.66667 10.8333C3.48257 10.8333 3.33333 10.9826 3.33333 11.1667M4 11.1667H3.33333M7.33333 11.1667C7.33333 11.3508 7.1841 11.5 7 11.5C6.81591 11.5 6.66667 11.3508 6.66667 11.1667M7.33333 11.1667C7.33333 10.9826 7.1841 10.8333 7 10.8333C6.81591 10.8333 6.66667 10.9826 6.66667 11.1667M7.33333 11.1667H6.66667M10.6667 11.1667C10.6667 11.3508 10.5174 11.5 10.3333 11.5C10.1492 11.5 10 11.3508 10 11.1667M10.6667 11.1667C10.6667 10.9826 10.5174 10.8333 10.3333 10.8333C10.1492 10.8333 10 10.9826 10 11.1667M10.6667 11.1667H10M3 13.8333H11C12.1046 13.8333 13 12.9379 13 11.8333V3.83332C13 2.72875 12.1046 1.83332 11 1.83332H3C1.89543 1.83332 1 2.72875 1 3.83332V11.8333C1 12.9379 1.89543 13.8333 3 13.8333Z" stroke="#9DA4AE" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                {{ review.date_added }}
                            </div>
                        </div>
                    </div>
                    <div class="pr-store-reviews-item-text dark-text fsz-14 pb-4 border-bottom">
                        {% if review.positive_text %}
                            <div class="pr-store-reviews-item-plus d-flex align-items-center gap-3 fsz-14 mb-3">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22" fill="none">
                                    <path d="M11 1V21M1 11H21" stroke="#4AB246" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                <div class="d-flex flex-column">
                                    <span class="fw-600">{{ text_review_positive_text }}</span>
                                    <p>{{ review.positive_text }}</p>
                                </div>
                            </div>
                        {% endif %}
                        {% if review.negative_text %}
                            <div class="pr-store-reviews-item-minus d-flex align-items-center gap-3 fsz-14 mb-3">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="2" viewBox="0 0 22 2" fill="none">
                                    <path d="M1 1H21" stroke="#D51F1F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                <div class="d-flex flex-column">
                                    <span class="fw-600">{{ text_review_negative_text }}</span>
                                    <p>{{ review.negative_text }}</p>
                                </div>
                            </div>
                        {% endif %}
                        {{ review.text }}
                    </div>
                    <div class="d-flex align-items-center gap-2 grey-text fsz-12 mt-1" onclick="addReviewReputation({{ review.review_id }});">
                        {{ text_is_good_review }}
                        <span class="d-inline-flex align-items-center gap-1" aria-label="Like">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                <path d="M5.00019 7.79996V17.0004M5.00019 7.79996H3.40011C2.07457 7.79996 1 8.87453 1 10.2001V14.6003C1 15.9258 2.07457 17.0004 3.40011 17.0004H13.7416C14.9262 17.0004 15.9337 16.1361 16.1138 14.9652L16.9754 9.36497C17.1991 7.91108 16.0742 6.5999 14.6032 6.5999H10.6005V2.99973C10.6005 1.89511 9.70498 0.999634 8.60036 0.999634H8.3361C8.01191 0.999634 7.71976 1.19528 7.59633 1.49506L5.00019 7.79996Z" stroke="#9DA4AE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span id="review-{{ review.review_id }}">{{ review.positive_votes }}</span>
                        </span>
                    </div>
                </div>
                {% if review.admin_answer %}
                    <div class="pr-product-reviews-item pr-product-reviews-item-answer p-3 mt-3 mt-lg-4 br-6 bg-grey position-relative">
                        <div class="pr-product-reviews-item-header d-flex justify-content-between align-items-center pb-3">
                            <div class="pr-product-reviews-item-answer-title dark-text fw-500 fsz-14">{{ text_faq_answer }}</div>
                        </div>
                        <div class="pr-product-reviews-item-content pt-3 fsz-14 fw-300 dark-text">{{ review.admin_answer }}</div>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <div class="d-flex flex-column justify-content-center pr-empty-reviews mb-3 mb-md-0 text-center p-4 br-4">
            <p class="fw-500 fsz-16 mb-5">{{ oct_text_no_reviews }}</p>
            <svg class="mx-auto" xmlns="http://www.w3.org/2000/svg" width="80" height="77" viewBox="0 0 80 77" fill="none">
                <path d="M39.9979 0.598633C16.4455 0.598633 0 15.3178 0 36.3904C0 45.0805 2.77917 52.861 8.05468 58.9576C7.47787 61.509 5.88148 65.5342 1.46066 69.1046C0.14704 70.2161 -0.323947 71.9928 0.252865 73.6222C0.829678 75.239 2.2951 76.3124 3.97081 76.3503C4.5392 76.3713 5.11926 76.3801 5.72133 76.3801C12.0326 76.3801 19.9185 75.1503 25.4551 70.0348C30.0149 71.4579 34.8992 72.1821 40.0021 72.1821C63.5545 72.1821 80 57.463 80 36.3904C80 15.3178 63.5504 0.598633 39.9979 0.598633ZM39.9979 67.9764C34.895 67.9764 30.0406 67.1929 25.5692 65.6477C24.7777 65.374 23.91 65.5934 23.3458 66.1997C18.4029 71.4752 10.2223 72.3507 4.22264 72.3507C4.19738 72.3507 4.16773 72.3507 4.14247 72.3507C8.6475 68.7088 11.5829 63.8461 12.3955 58.659C12.4924 58.0232 12.2979 57.3791 11.86 56.9033C6.85815 51.4846 4.21031 44.39 4.21031 36.3904C4.21031 17.7934 18.9253 4.80894 39.9979 4.80894C61.0705 4.80894 75.7856 17.7934 75.7856 36.3904C75.7856 54.9873 61.0705 67.9764 39.9979 67.9764ZM56.4856 28.77L47.6528 27.5488L43.7909 19.785C42.351 16.8883 37.6313 16.8883 36.1998 19.785L32.4233 27.4815L23.5103 28.77C21.9483 28.9931 20.6815 30.0666 20.1974 31.5613C19.7174 33.0517 20.1164 34.6559 21.2448 35.7464L27.6487 41.864L26.1798 50.3812C25.9019 51.9727 26.5419 53.5515 27.847 54.5072C29.1607 55.4714 30.8743 55.598 32.3184 54.8444L39.9476 50.815L47.6774 54.8485C48.3006 55.1727 48.9786 55.3327 49.6438 55.3327C50.5238 55.3327 51.3995 55.055 52.1447 54.5119C53.4541 53.5603 54.094 51.981 53.8161 50.3853L52.3092 41.9735L58.7511 35.7423C59.8795 34.6518 60.2785 33.0476 59.7985 31.5572C59.3143 30.0667 58.0476 28.9973 56.4856 28.77ZM49.3827 38.9463C48.4144 39.8852 47.9681 41.2406 48.1996 42.5753L49.6315 51.1095L41.9047 47.0806C41.3068 46.7691 40.6547 46.6129 40.0021 46.6129C40.0021 46.6129 40.0021 46.6129 40.0021 46.6129C39.3495 46.6129 38.693 46.7691 38.1035 47.0806L30.3356 51.0972L31.8086 42.5753C32.036 41.2448 31.5897 39.8851 30.6214 38.9504L24.1168 32.9381L33.0256 31.6538C34.3561 31.4643 35.5136 30.631 36.1114 29.4268L40.0185 21.6461C40.0185 21.6461 40.0235 21.65 40.0278 21.6584C40.0278 21.6584 40.0277 21.6584 40.0319 21.6584L43.8927 29.4268C44.4948 30.631 45.6481 31.4602 46.9744 31.6497L55.8288 32.7151L49.3827 38.9463Z" fill="#F2F2F2"/>
                </svg>
        </div>
    {% endif %}
</div>

{% if reviews %}
	<div id="review-pagination" class="d-none" data-has-more="{{ has_more ? 'true' : 'false' }}" data-next-page="{{ next_page }}"></div>
	{% if has_more %}
		<div class="pr-module-show-more d-flex justify-content-center pt-3 pt-md-4">
            <button id="load-more-reviews" class="button button-success button-large fsz-14 br-8">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="15" viewBox="0 0 18 17" fill="none">
                    <path d="M16.5448 11.1667C15.4466 14.2738 12.4833 16.5 9 16.5C4.58172 16.5 1 12.9183 1 8.5C1 4.08172 4.58172 0.5 9 0.5C13 0.5 14.7778 3.16667 17 5.38889M12.5556 5.38889L16.9991 5.38982V0.944444" stroke="#FFFDFF" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                {{ oct_show_more }}
            </button>
        </div>
	{% endif %}

	{% if not ajax %}
	<script>
		function addReviewReputation(review_id) {
			$.ajax({
				url: 'index.php?route=octemplates/events/helper/octReviewReputation&review_id=' + review_id,
				dataType: 'json',
				success: function(json) {
					if (json['error']) {
						prNotify('danger', json['error']);
					}
					if (json['success']) {
						var reviewElement = $('#review-' + review_id);
						var currentVotes = parseInt(reviewElement.text());
						reviewElement.text(currentVotes + 1);
						prNotify('success', json['success']);
					}
				}
			});
		}

		function loadMoreReviews() {
			if (window.loadingMoreReviews) return;
			window.loadingMoreReviews = true;
			
			var $pagination = $('#review-pagination');
			var hasMore = $pagination.attr('data-has-more');
			var nextPage = $pagination.attr('data-next-page');
			
			if (hasMore === "false" || !nextPage) {
				$('#load-more-reviews').remove();
				window.loadingMoreReviews = false;
				return;
			}
			
			$.ajax({
				url: 'index.php?route=octemplates/events/helper/octProductReviews&oct_product_id={{ product_id }}&page=' + nextPage,
				type: 'GET',
				dataType: 'html',
				beforeSend: function() {
					$('#load-more-reviews').prop('disabled', true);
					masked('body', true);

					},
					complete: function() {
					$('#load-more-reviews').prop('disabled', false);
					masked('body', false);
				},
				success: function(html) {
					var $temp = $('<div>').html(html);
					var $newReviewsContainer = $temp.find('#reviews-container');
					var newReviewsContent = $newReviewsContainer.length ? $newReviewsContainer.html() : $temp.html();
					$('#reviews-container').append(newReviewsContent);
					
					var $newPagination = $temp.find('#review-pagination');
					if ($newPagination.length) {
						$('#review-pagination').attr('data-has-more', $newPagination.attr('data-has-more'));
						$('#review-pagination').attr('data-next-page', $newPagination.attr('data-next-page'));
						if ($newPagination.attr('data-has-more') === "false") {
							$('#load-more-reviews').remove();
						}
					} else {
						$('#load-more-reviews').remove();
					}
					window.loadingMoreReviews = false;
				},
				error: function() {
					window.loadingMoreReviews = false;
				}
			});
		}

		$(document).ready(function(){
			$(document).on('click', '#load-more-reviews', function(e){
				e.preventDefault();
				loadMoreReviews();
			});
		});
	</script>
	{% endif %}
{% endif %}